
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dnviti.github.io/SmartWifiFanController/06-technical-details/">
      
      
        <link rel="prev" href="../05-usage-guide/">
      
      
        <link rel="next" href="../07-troubleshooting/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Technical Details - SmartWifiFanController Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-6-technical-details-protocols" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="SmartWifiFanController Docs" class="md-header__button md-logo" aria-label="SmartWifiFanController Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SmartWifiFanController Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Technical Details
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dnviti/SmartWifiFanController" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    dnviti/SmartWifiFanController
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../01-introduction/" class="md-tabs__link">
        
  
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../02-hardware/" class="md-tabs__link">
        
  
  
    
  
  Hardware

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../03-software/" class="md-tabs__link">
        
  
  
    
  
  Software

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../04-setup-and-installation/" class="md-tabs__link">
        
  
  
    
  
  Setup and Installation

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../05-usage-guide/" class="md-tabs__link">
        
  
  
    
  
  Usage Guide

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  Technical Details

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../07-troubleshooting/" class="md-tabs__link">
        
  
  
    
  
  Troubleshooting

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../08-future-enhancements/" class="md-tabs__link">
        
  
  
    
  
  Future Enhancements

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="SmartWifiFanController Docs" class="md-nav__button md-logo" aria-label="SmartWifiFanController Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    SmartWifiFanController Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dnviti/SmartWifiFanController" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    dnviti/SmartWifiFanController
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hardware
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-software/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Software
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-setup-and-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup and Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-usage-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Technical Details
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Technical Details
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#61-pwm-fan-control" class="md-nav__link">
    <span class="md-ellipsis">
      6.1. PWM Fan Control
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#62-i2c-communication" class="md-nav__link">
    <span class="md-ellipsis">
      6.2. I2C Communication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#63-fan-tachometer-rpm-sensing" class="md-nav__link">
    <span class="md-ellipsis">
      6.3. Fan Tachometer (RPM Sensing)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#64-wifi-and-networking-web-server-websockets" class="md-nav__link">
    <span class="md-ellipsis">
      6.4. WiFi and Networking (Web Server &amp; WebSockets)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#65-mqtt-integration-for-home-automation" class="md-nav__link">
    <span class="md-ellipsis">
      6.5. MQTT Integration for Home Automation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#66-spiffs-filesystem-usage" class="md-nav__link">
    <span class="md-ellipsis">
      6.6. SPIFFS Filesystem Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#67-nvs-non-volatile-storage-for-persistence" class="md-nav__link">
    <span class="md-ellipsis">
      6.7. NVS (Non-Volatile Storage) for Persistence
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#68-conditional-debug-mode" class="md-nav__link">
    <span class="md-ellipsis">
      6.8. Conditional Debug Mode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#69-dual-core-operation-freertos-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      6.9. Dual-Core Operation (FreeRTOS Tasks)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#610-over-the-air-ota-updates" class="md-nav__link">
    <span class="md-ellipsis">
      6.10. Over-the-Air (OTA) Updates
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-future-enhancements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Future Enhancements
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="chapter-6-technical-details-protocols"><strong>Chapter 6: Technical Details &amp; Protocols</strong><a class="headerlink" href="#chapter-6-technical-details-protocols" title="Permanent link">&para;</a></h1>
<p>This chapter delves into the specific technologies, protocols, and implementation details used within the ESP32 PC Fan Controller project.</p>
<h2 id="61-pwm-fan-control"><strong>6.1. PWM Fan Control</strong><a class="headerlink" href="#61-pwm-fan-control" title="Permanent link">&para;</a></h2>
<p><em>(No changes)</em></p>
<h2 id="62-i2c-communication"><strong>6.2. I2C Communication</strong><a class="headerlink" href="#62-i2c-communication" title="Permanent link">&para;</a></h2>
<p><em>(No changes)</em></p>
<h2 id="63-fan-tachometer-rpm-sensing"><strong>6.3. Fan Tachometer (RPM Sensing)</strong><a class="headerlink" href="#63-fan-tachometer-rpm-sensing" title="Permanent link">&para;</a></h2>
<p><em>(No changes)</em></p>
<h2 id="64-wifi-and-networking-web-server-websockets"><strong>6.4. WiFi and Networking (Web Server &amp; WebSockets)</strong><a class="headerlink" href="#64-wifi-and-networking-web-server-websockets" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>WiFi Client Mode (STA):</strong> The ESP32 connects to an existing WiFi network. <strong>The hostname is dynamically set to fancontrol-[macaddress] for easier network identification.</strong>  </li>
<li><strong>ESPAsyncWebServer Library:</strong>  </li>
<li>Used for creating an HTTP server.  </li>
<li>Serves static files (index.html, style.css, script.js) from SPIFFS.  </li>
<li><strong>Hosts the ElegantOTA endpoint (/update) for manual OTA updates.</strong>  </li>
<li><strong>WebSockets (WebSocketsServer library):</strong>  </li>
<li>Provides persistent, full-duplex communication for the web UI.  </li>
<li><strong>Transmits OTA status messages and receives OTA trigger commands.</strong>  </li>
<li><strong>Data Format:</strong> JSON (ArduinoJson library) for WebSocket data.</li>
</ul>
<h2 id="65-mqtt-integration-for-home-automation"><strong>6.5. MQTT Integration for Home Automation</strong><a class="headerlink" href="#65-mqtt-integration-for-home-automation" title="Permanent link">&para;</a></h2>
<p><em>(Status JSON now includes OTA info)</em></p>
<ul>
<li><strong>Protocol:</strong> MQTT.  </li>
<li><strong>Library:</strong> PubSubClient.  </li>
<li><strong>Configuration:</strong> (As before).  </li>
<li><strong>Home Assistant MQTT Discovery:</strong> (As before).  </li>
<li><strong>Topics and Payloads:</strong>  </li>
<li><strong>Status Topic (JSON):</strong> (e.g., YOUR_BASE_TOPIC/status_json) - Publishes a comprehensive JSON object. <strong>Now includes firmwareVersion, otaInProgress, and otaStatusMessage.</strong>  </li>
<li>Other topics (as before).  </li>
<li><strong>Processing:</strong> (As before).</li>
</ul>
<h2 id="66-spiffs-filesystem-usage"><strong>6.6. SPIFFS Filesystem Usage</strong><a class="headerlink" href="#66-spiffs-filesystem-usage" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Web Interface Files:</strong> Stores index.html, style.css, script.js.  </li>
<li><strong>Root CA Certificate for OTA:</strong> Stores the Root CA certificate (e.g., /github_api_ca.pem) used for secure HTTPS connections to GitHub for OTA updates. This file is loaded into memory at boot. The GitHub Actions pipeline includes the latest CA in the spiffs.bin of releases.</li>
</ul>
<h2 id="67-nvs-non-volatile-storage-for-persistence"><strong>6.7. NVS (Non-Volatile Storage) for Persistence</strong><a class="headerlink" href="#67-nvs-non-volatile-storage-for-persistence" title="Permanent link">&para;</a></h2>
<p><em>(No changes)</em></p>
<h2 id="68-conditional-debug-mode"><strong>6.8. Conditional Debug Mode</strong><a class="headerlink" href="#68-conditional-debug-mode" title="Permanent link">&para;</a></h2>
<p><em>(No changes)</em></p>
<h2 id="69-dual-core-operation-freertos-tasks"><strong>6.9. Dual-Core Operation (FreeRTOS Tasks)</strong><a class="headerlink" href="#69-dual-core-operation-freertos-tasks" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Core 0 (networkTask):</strong> Handles WiFi, ESPAsyncWebServer (including ElegantOTA), WebSockets, MQTT client.  </li>
<li><strong>Core 1 (mainAppTask):</strong> Handles main application logic, sensors, LCD, buttons, serial commands. <strong>The GitHub OTA check and update process (HTTPClient, HTTPUpdate) are initiated from this core's context when triggered, which can be blocking during the download/flash phases.</strong></li>
</ul>
<h2 id="610-over-the-air-ota-updates"><strong>6.10. Over-the-Air (OTA) Updates</strong><a class="headerlink" href="#610-over-the-air-ota-updates" title="Permanent link">&para;</a></h2>
<p>The controller implements two OTA update mechanisms:</p>
<ol>
<li><strong>ElegantOTA (Manual Web Upload):</strong>  </li>
<li><strong>Library:</strong> ayushsharma82/ElegantOTA.  </li>
<li><strong>Interface:</strong> Provides a web page at the /update endpoint of the ESP32's IP address.  </li>
<li><strong>Functionality:</strong> Allows users to manually upload pre-compiled firmware.bin or spiffs.bin files directly to the device.  </li>
<li><strong>Initialization:</strong> ElegantOTA.begin(\&amp;server); is called in networkTask after the web server starts. ElegantOTA.loop() is also called in networkTask.  </li>
<li><strong>GitHub Release Updater (Automated Check &amp; Install):</strong>  </li>
<li><strong>Module:</strong> Custom logic in ota_updater.h and ota_updater.cpp.  </li>
<li><strong>Trigger:</strong> Can be initiated via LCD menu, Web UI, or a serial command (ota_update).  </li>
<li><strong>Process:</strong>  <ol>
<li><strong>Fetch Latest Release Info:</strong>  <ul>
<li>Makes an HTTPS GET request to the GitHub API (GITHUB_API_LATEST_RELEASE_URL).  </li>
<li>Uses WiFiClientSecure configured with a Root CA certificate loaded from SPIFFS (GITHUB_API_ROOT_CA_STRING loaded from GITHUB_ROOT_CA_FILENAME).  </li>
<li>Parses the JSON response (using ArduinoJson) to find the tag_name (version) and asset download URLs for firmware (firmware_PIO_BUILD_ENV_NAME_vX.Y.Z.bin) and SPIFFS (spiffs_PIO_BUILD_ENV_NAME_vX.Y.Z.bin). PIO_BUILD_ENV_NAME must match the environment name used in the GitHub Actions release workflow.  </li>
</ul>
</li>
<li><strong>Version Comparison:</strong>  <ul>
<li>Compares the fetched tag_name with the FIRMWARE_VERSION define.  </li>
</ul>
</li>
<li><strong>Update Execution (if newer version found):</strong>  <ul>
<li>Uses the HTTPUpdate library.  </li>
<li><strong>Firmware Update:</strong> Calls httpUpdate.update(client, firmwareURL).  </li>
<li><strong>SPIFFS Update:</strong> Calls httpUpdate.updateSpiffs(client, spiffsURL).  </li>
<li>Both use WiFiClientSecure configured with the loaded Root CA from SPIFFS.  </li>
<li>The device reboots automatically after a successful update by HTTPUpdate.  </li>
</ul>
</li>
</ol>
</li>
<li><strong>Root CA Management:</strong> The Root CA certificate is stored on SPIFFS. The GitHub Actions workflow is designed to download the latest relevant CA during its build process and include it in the spiffs.bin of the release assets. This allows the CA to be updated via a SPIFFS OTA update.  </li>
<li><strong>Security:</strong> Relies on HTTPS for communication with GitHub. The validity of the connection depends on the correctness and currency of the Root CA certificate stored on SPIFFS.</li>
</ol>
<p><a href="../05-usage-guide/">Previous Chapter: Usage Guide</a> | <a href="../07-troubleshooting/">Next Chapter: Troubleshooting</a></p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>