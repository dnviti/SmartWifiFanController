# **Chapter 4: Setup and Installation**

This chapter guides you through assembling the hardware, setting up the software environment using PlatformIO, and uploading the firmware and web files to your ESP32.

## **4.1. Hardware Assembly Tips**

*(No changes to this section, as OTA is primarily a software/network feature)*

## **4.2. Software Setup (PlatformIO)**

*(Minor addition for clarity on build environment name)*

1. **Install Visual Studio Code:** Download and install from [code.visualstudio.com](https://code.visualstudio.com/).  
2. **Install PlatformIO IDE Extension:**  
   * Open VS Code.  
   * Go to the Extensions view (Ctrl+Shift+X or click the square icon on the sidebar).  
   * Search for "PlatformIO IDE" and install it.  
3. **Obtain Project Files:**  
   * Clone the project repository from GitHub or download the source code ZIP.  
4. **Open Project in PlatformIO:**  
   * In VS Code, go to File \> Open Folder... and select the root folder of the cloned/downloaded project.  
   * PlatformIO should automatically recognize the platformio.ini file and set up the project environment.  
5. **Review platformio.ini:**  
   * Open the platformio.ini file in the project root.  
   * Ensure the board setting matches your specific ESP32 development board model.  
   * Verify the lib\_deps section lists all required libraries.  
   * **Note the PlatformIO environment name (e.g., upesy\_wroom or esp32\_fancontrol as defined in PIO\_ENV in the GitHub Actions workflow and PIO\_BUILD\_ENV\_NAME in config.h). This is important for GitHub OTA release asset naming.**  
6. **Configure Default WiFi (Optional):**  
   * Open src/main.cpp.  
   * Locate char current\_ssid\[64\] \= "YOUR\_WIFI\_SSID"; and char current\_password\[64\] \= "YOUR\_WIFI\_PASSWORD";.  
   * You can change these to your network's credentials for default connection attempts.

## **4.3. Uploading Firmware and Filesystem Data**

The project requires both the main firmware and the web interface files (HTML, CSS, JS) to be uploaded to the ESP32. **Additionally, for OTA updates from GitHub, a Root CA certificate file needs to be on the SPIFFS.**

1. **Prepare Files for SPIFFS:**  
   * In the root directory of your PlatformIO project, ensure you have a data folder.  
   * Place your index.html, style.css, and script.js files directly inside this data folder.  
   * **For GitHub OTA Updates:**  
     * The GitHub Actions release pipeline is configured to automatically download the appropriate Root CA certificate and place it as github\_api\_ca.pem (or the name defined by CA\_CERT\_FILENAME in the workflow) into the data directory *during the GitHub Actions run*.  
     * When you build and upload the filesystem image *locally for the first time or for testing*, you would need to manually place the correct Root CA certificate file (e.g., github\_api\_ca.pem, matching GITHUB\_ROOT\_CA\_FILENAME in config.h) into your local data folder before building the SPIFFS image. The device firmware will then load this certificate from SPIFFS at boot.  
     * **The release assets generated by the GitHub Actions pipeline will already have this CA certificate embedded in their spiffs.bin.**  
2. **Build and Upload Filesystem Image (SPIFFS):**  
   * This step uploads the contents of the data folder (including your web files and the CA certificate if placed manually) to the ESP32's SPIFFS partition.  
   * **In VS Code with PlatformIO:**  
     * Click on the PlatformIO icon (alien head) in the VS Code activity bar.  
     * Expand your project environment.  
     * Under "Platform", find and click on "Upload Filesystem Image".  
   * **Using PlatformIO Core CLI:**  
     * Run the command: pio run \--target uploadfs  
   * This process builds a SPIFFS image and uploads it. You need to do this whenever you change files in the data folder locally.  
3. **Build and Upload Firmware:**  
   * This compiles your C++ code and uploads the resulting binary to the ESP32.  
   * **Initial Upload (Serial):**  
     * Ensure upload\_protocol \= espota is commented out or not present in platformio.ini.  
     * **In VS Code with PlatformIO:** Click "Build" then "Upload".  
     * **Using PlatformIO Core CLI:** pio run \--target upload  
   * **Subsequent Uploads (OTA via ElegantOTA Web UI):**  
     * After the initial serial upload, if WiFi is connected, you can navigate to http://\<ESP32\_IP\_ADDRESS\>/update to upload new firmware.bin or spiffs.bin files.  
   * **Subsequent Uploads (OTA via PlatformIO):**  
     * Uncomment upload\_protocol \= espota in platformio.ini.  
     * Set upload\_port \= \<ESP32\_IP\_ADDRESS\_OR\_HOSTNAME\>.  
     * **In VS Code with PlatformIO:** Click "Upload".  
     * **Using PlatformIO Core CLI:** pio run \--target upload

After completing these steps, your ESP32 should be running the fan controller firmware. The GitHub OTA update feature will rely on the CA certificate being present in the SPIFFS image.

[Previous Chapter: Software](03-software.md) | [Next Chapter: Usage Guide](05-usage-guide.md)